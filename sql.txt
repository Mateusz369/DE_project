
DROP TABLE medallion_drivers_status

CREATE TABLE medallion_drivers_status (
license_number TEXT,
name TEXT,
type TEXT,
expiration_date DATE,
last_updated_date DATE,
present_date DATE,
current_status TEXT,
PRIMARY KEY (license_number, last_updated_date, present_date)
)



INSERT INTO medallion_drivers_status

WITH yesterday AS (
SELECT *
FROM medallion_drivers_status
WHERE present_date = '2026-01-05'
),

today AS(
SELECT *
FROM medallion_drivers_active
WHERE CAST(last_updated_date AS date) = '2026-01-06'
)

SELECT
COALESCE(t.license_number, y.license_number) AS license_number,
COALESCE(t.name, y.name) AS name,
COALESCE(t.type, y.type) AS type,
COALESCE(CAST(t.expiration_date AS date), CAST(y.expiration_date AS date)) AS expiration_date,
COALESCE(CAST(t.last_updated_date AS date), CAST(y.last_updated_date AS date)) AS last_updated_date,
'2026-01-06' AS present_date,
CASE
	WHEN t.last_updated_date IS NOT NULL THEN 'active'
	ELSE 'inactive'
END AS current_status
FROM today t FULL OUTER JOIN yesterday y
ON t.license_number = y.license_number


SELECT * FROM medallion_drivers_status
--WHERE present_date = '2026-01-06'
--AND current_status = 'inactive'
WHERE license_number = '5664815'


--Nie przedłużył
SELECT * FROM medallion_drivers_active
--WHERE date(expiration_date) = '2026-01-04'
--WHERE license_number = '5735207'
WHERE name ='FIGUEROA,LUIS'


--Skończyło sie i przedłużył po 2 dniach:
SELECT * FROM medallion_drivers_active
WHERE license_number = '5664815'



